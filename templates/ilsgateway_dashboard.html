{% extends "base.html" %}
{% load i18n %}

{% block title %}Dashboard{{ block.super }}{% endblock %}
{% block javascripts %}
    <!--[if IE]><script language="javascript" type="text/javascript" src="/static/ilsgateway/javascripts/excanvas.js"></script><![endif]-->
{{ block.super }}
    <script language="javascript" type="text/javascript" src="/static/ilsgateway/javascripts/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="/static/ilsgateway/javascripts/jquery.flot.pie.js"></script>
    <script language="javascript" type="text/javascript" src="/static/ilsgateway/javascripts/jquery.flot.stack.js"></script>
    <script language="javascript">
        $(document).ready(function() { 
                                      
            var data = [
                { label: "Submitted",  data: {{ sdp.child_sdps_submitted_randr_this_month }} },
                { label: "Haven't Submitted",  data: {{ sdp.child_sdps_not_submitted_randr_this_month }} },
                { label: "Didn't Respond",  data: {{ sdp.child_sdps_not_responded_randr_this_month }} },
                { label: "No Contact Info",  data: {{ sdp.count_child_sdps_no_primary_contact }} }
            ]
            // DEFAULT
            $.plot($("#placeholder"), data, 
            {
                series: {
                    pie: { 
                        show: true,
                        radius: 1,
                        label: {
                            show: true,
                            radius: 1,
                            formatter: function(label, series){
                                return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">'+label+'<br/>'+Math.round(series.percent)+'%</div>';
                            },
                            background: { opacity: 0.8 }
                        }                        
                    }
                },
                legend: {
                    show: false
                }
            });                                         

            var d1 = [[0, {{ sdp.child_sdps_submitted_randr_this_month }}]];
            var d2 = [[2, {{ sdp.child_sdps_not_submitted_randr_this_month }}]];
            var d3 = [[4, {{ sdp.child_sdps_not_responded_randr_this_month }}]];
            var d4 = [[6, {{ sdp.count_child_sdps_no_primary_contact }}]];
                                
            bar_options = {                     
               series: {
                 stack: true,
                 lines: { show: false, steps: false },
                 bars: { show: true, barWidth: 1 }
               },
               xaxis: { 
                       ticks: {{ bar_ticks|safe }},
                       max: 12
                      }, 
               legend: {show: true, position: 'nw'},
               yaxis: {max: {{ max_stockout_graph }} }
            };
            $.plot($("#placeholder2"), {{ bar_data|safe }}, bar_options);    
        });
</script>
{% endblock %}

{% block content %}
<div class="crumbs">{% for title, href in breadcrumbs %}{% if not forloop.first %} &raquo; {% endif %}{% if href %}<a href="{{href}}">{{ title }}</a>{% else %}{{ title }}{% endif %}{% endfor %}</div>
<div class="welcome">{% trans 'Welcome' %}, {{ user.username }}</div>
<div style="clear:both;">&nbsp;</div>
<div class="module">
    <h2>{% trans 'Alerts' %}</h2>
    <ul class="alerts"">
        {% if sdp.child_sdps_not_submitted_randr_this_month %}<li><a href="{% url ordering %}">{{ sdp.child_sdps_not_submitted_randr_this_month }} Facilities</a> have reported not submitting their R &amp; R form as of today.</li>{% endif %}
        {% if sdp.child_sdps_not_responded_randr_this_month %}<li><a href="{% url ordering %}">{{ sdp.child_sdps_not_responded_randr_this_month }} Facilities</a> did not respond to the SMS asking if they had submitted their R&amp;R form.</li>{% endif %}
        {% if sdp.child_sdps_not_responded_soh_this_month %}<li><a href="/facilities/inventory">{{ sdp.count_child_sdps_not_responded_soh_since_last_month }} Facilities</a> have not reported their stock levels for last month.</li>{% endif %}
        {% if sdp.child_sdps_not_received_delivery_this_month %}<li><a href="{% url ordering %}">{{ sdp.child_sdps_not_received_delivery_this_month }} Facilities</a> have reported not receiving their deliveries as of today.</li>{% endif %}
        {% if sdp.child_sdps_not_responded_delivery_this_month %}<li><a href="{% url ordering %}">{{ sdp.child_sdps_not_responded_delivery_this_month }} Facilities</a> did not respond to the SMS asking if they had received their delivery.</li>{% endif %}
        {% for product, facilities in stockouts_by_product %}{% for facility in facilities %}
            <li><a href="{% url ilsgateway.views.facilities_detail facility.id %}">{{ facility.name }}</a> is stocked out of {{ product }}.</li>
        {% endfor %}{% endfor %}
        {% for facility in facilities_without_primary_contacts %}
            <li><a href="{% url ilsgateway.views.facilities_detail facility.id %}">{{ facility.name }}</a> has no primary contact.  <a href="{% url registration %}">Register someone now &raquo;</a></li>
        {% endfor %}
    </ul>
</div>

<div class="split-3">
    <div class="left">
        <div class="module">
            <h2>R&amp;R Submission Summary</h2>
            <!--<div class="toolbar">
                <a href="">All Reports</a>
            </div>-->
            <div id="placeholder" style="width:300px;height:300px;"></div>
        </div>
    </div>
    <div class="mid">
        <div class="module">
            <h2>Product Availability Summary</h2>
            <!--<div class="toolbar">
                <a href="">All Stats</a>
            </div>-->
            <div id="placeholder2" style="width:300px;height:300px;"></div>
        </div>
    </div>
    <div class="right">
        <div class="module">
            <h2>District Summary</h2>
            <!--<div class="toolbar">
                <a href="">All Stats</a>
            </div>-->
            <ul class="stats">
                <li>
                    <div class="report">{{ counts.total }}</div>
                    <div class="caption"><a href="{% url ordering %}">Facilities</a></div>
                </li>
                <li>
                    <div class="report">Group {{ groups.current_submitting_group }}: Submitting</div>
                    <div class="caption">{{ sdp.child_sdps_submitted_randr_this_month }} of {{ counts.current_submitting_group }} <a href="{% url ordering %}">submitted</a></div>
                </li>
                <li>
                    <div class="report">Group {{ groups.current_processing_group }}: Processing</div>
                    <div class="caption">{{ sdp.child_sdps_processing_sent_to_msd }} of {{ counts.current_processing_group }} forms sent to MSD</div>
                </li>
                <li>
                    <div class="report">Group {{ groups.current_delivering_group }}: Deliveries</div>
                    <div class="caption">{{ sdp.child_sdps_submitted_randr_this_month }} of {{ counts.current_delivering_group }} <a href="{% url ordering %}">delivered</a></div>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="clear-hack"></div>
{% endblock %}

